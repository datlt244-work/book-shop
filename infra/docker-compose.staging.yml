# =============================================================================
# Docker Compose - STAGING Environment
# =============================================================================
# Usage: docker-compose -f docker-compose.yml -f docker-compose.staging.yml up -d
# =============================================================================

services:
  postgres:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    # No external port exposure in staging
    ports: []

  mongodb:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_USER}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}
    ports: []

  redis:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
    command: redis-server --requirepass ${REDIS_PASSWORD}
    ports: []

  kafka:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
    ports: []

  consul:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
    # Only expose internally
    ports: []

  vault:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: ""
      VAULT_ADDR: "http://0.0.0.0:8200"
    # Use production mode in staging
    command: server
    ports: []

  minio:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
    environment:
      MINIO_ROOT_USER: ${MINIO_USER}
      MINIO_ROOT_PASSWORD: ${MINIO_PASSWORD}
    ports: []

